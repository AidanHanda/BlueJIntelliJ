import click
import setuptools
import shutil
import os
import fileinput
import os
import zipfile
import base64

template = """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
BgAAAAAFAAUAYAEAAGoKAAAAAA==
"""


@click.command("convert")
@click.argument('oldProject')
@click.argument('outProject')
@click.argument('name')
def createProject(oldproject, outproject, name):
    oldproject = oldproject.strip("/")
    outproject = outproject.strip("/")
    with open(outproject + ".zip", "wb") as f:
        f.write(base64.b64decode(template))
    zip_ref = zipfile.ZipFile(outproject+".zip", 'r')
    zip_ref.extractall(outproject)
    zip_ref.close()
    shutil.copytree(oldproject, outproject + "/src")
    os.rename(outproject + "/rename.iml", outproject + "/%s.iml" % name)
    with fileinput.FileInput(outproject + "/.idea/modules.xml", inplace=True, backup='.bak') as file:
        for line in file:
            print(line.replace("rename", name), end='')




if __name__ == "__main__":
    createProject()
